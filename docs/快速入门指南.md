# qstock 快速入门指南

> **5分钟快速上手qstock量化投研库**

## 📦 安装

```bash
pip install qstock
```

更新到最新版本：
```bash
pip install --upgrade qstock
```

---

## 🚀 基础使用

### 导入库

```python
import qstock as qs
```

---

## 💡 常用功能速查

### 1. 获取实时行情

```python
# 获取沪深A股所有股票实时行情
df = qs.realtime_data()

# 获取单只股票
df = qs.realtime_data(code='中国平安')

# 获取多只股票
df = qs.realtime_data(code=['中国平安','贵州茅台','宁德时代'])

# 获取板块行情
df = qs.realtime_data('概念板块')
df = qs.realtime_data('行业板块')
```

### 2. 获取历史K线

```python
# 获取日线数据（默认前复权）
df = qs.get_data('中国平安')

# 指定时间范围
df = qs.get_data('中国平安', start='20200101', end='20231231')

# 获取分钟数据
df = qs.get_data('中国平安', start='20231201', freq=5)  # 5分钟

# 获取周线数据
df = qs.get_data('中国平安', freq='w')

# 后复权
df = qs.get_data('中国平安', fqt=2)

# 批量获取
code_list = ['中国平安','贵州茅台','宁德时代']
df = qs.get_data(code_list)
```

### 3. 获取资金流数据

```python
# 个股历史资金流
df = qs.hist_money('中国平安')

# 个股N日资金流累计
df = qs.stock_money('中国平安', ndays=[5, 10, 20])

# 北向资金
df = qs.north_money()  # 每日净流入
df = qs.north_money('个股', 5)  # 5日增持个股排行
```

### 4. 财务数据

```python
# 基本财务指标
df = qs.stock_basics('中国平安')

# 业绩报表
df = qs.financial_statement('业绩报表', date='20230930')

# 资产负债表
df = qs.financial_statement('资产负债表')

# 现金流量表
df = qs.financial_statement('现金流量表')
```

### 5. 板块数据

```python
# 获取板块列表
df = qs.em_index_name('概念')  # 概念板块
df = qs.em_index_name('行业')  # 行业板块

# 获取板块成分股
df = qs.em_index_member('锂电池')

# 获取板块历史数据
df = qs.em_index_data('锂电池', start='20200101')
```

### 6. 宏观经济数据

```python
# GDP
df = qs.macro_data('gdp')

# CPI
df = qs.macro_data('cpi')

# PMI
df = qs.macro_data('pmi')

# 货币供应量
df = qs.macro_data('ms')
```

### 7. 新闻数据

```python
# 财联社电报（默认）
df = qs.news_data()

# 个股新闻
df = qs.news_data('个股', code='中国平安')

# 新闻联播
df = qs.news_data('cctv', start='20231201', end='20231210')
```

---

## 📊 可视化

### 导入可视化模块

```python
from qstock import plot
```

### K线图

```python
df = qs.get_data('中国平安', start='20230101')
plot.kline(df)
```

### 折线图

```python
# 价格走势
plot.line(df.close, title='中国平安价格走势')

# 多条对比
df['ma20'] = df.close.rolling(20).mean()
plot.line(df[['close','ma20']], title='价格与均线')
```

### 其他图表

```python
# 柱状图
plot.bar(data, title='涨跌幅对比')

# 散点图
plot.scatter(data, x='pe', y='roe')

# 饼图
plot.pie(data, x='类别', y='数值')
```

---

## 🎯 实战案例

### 案例1：筛选优质股票

```python
import qstock as qs

# 1. 获取全市场数据
df = qs.realtime_data('沪深A')

# 2. 筛选条件
filtered = df[
    (df['涨幅'] > 0) &           # 今日上涨
    (df['换手率'] > 2) &         # 换手率大于2%
    (df['换手率'] < 10) &        # 换手率小于10%
    (df['总市值'] > 100) &       # 总市值大于100亿
    (df['总市值'] < 1000)        # 总市值小于1000亿
]

# 3. 按涨幅排序
result = filtered.sort_values('涨幅', ascending=False)
print(result[['代码','名称','涨幅','换手率','总市值']].head(20))
```

### 案例2：均线策略回测

```python
from qstock.backtest.vec_backtest import *

# 1. 获取数据
df = data_feed('中国平安', start='20200101')

# 2. 计算均线
df['ma5'] = df.close.rolling(5).mean()
df['ma20'] = df.close.rolling(20).mean()

# 3. 生成交易信号
df['position'] = 0
df.loc[df['ma5'] > df['ma20'], 'position'] = 1  # 金叉买入
df.loc[df['ma5'] <= df['ma20'], 'position'] = 0  # 死叉卖出

# 4. 计算策略收益
df['capital_ret'] = df['position'].shift(1) * df['rets']
df['capital_ret'].fillna(0, inplace=True)

# 5. 绩效分析
result = trade_performance(df, plot=True)
print(result)
```

### 案例3：板块轮动

```python
import qstock as qs

# 1. 获取板块列表
df = qs.em_index_name('概念')

# 2. 按涨幅排序找强势板块
top_sectors = df.sort_values('涨跌幅', ascending=False).head(10)
print('强势概念板块TOP10：')
print(top_sectors[['板块名称','涨跌幅','领涨股票','领涨股票-涨跌幅']])

# 3. 获取强势板块成分股
sector_name = top_sectors.iloc[0]['板块名称']
stocks = qs.em_index_member(sector_name)
print(f'\n{sector_name} 成分股TOP10：')
print(stocks.head(10)[['代码','名称','涨跌幅']])
```

---

## 📋 数据字段说明

### 实时行情字段
- **代码**、**名称**：股票基本信息
- **最新**：最新价
- **涨幅**：涨跌幅(%)
- **涨跌额**：涨跌额(元)
- **成交量**：成交量(手)
- **成交额**：成交额(元)
- **换手率**：换手率(%)
- **市盈率**：市盈率(动态)
- **总市值**、**流通市值**：单位亿元

### 历史K线字段
- **date**：日期(索引)
- **name**：名称
- **code**：代码
- **open**、**high**、**low**、**close**：开高低收
- **volume**：成交量
- **turnover**：成交额
- **turnover_rate**：换手率

### 资金流字段
- **主力净流入**：大单+超大单净流入
- **大单净流入**：单笔>=20万
- **超大单净流入**：单笔>=50万
- **中单净流入**：单笔2-20万
- **小单净流入**：单笔<2万

---

## ⚠️ 注意事项

### 常见问题

1. **获取不到数据**
   - 检查网络连接
   - 数据源可能临时维护
   - 过一段时间重试

2. **1分钟数据限制**
   - 仅能获取最近5个交易日

3. **指数代码**
   - 使用简称：'sh'(上证)、'cyb'(创业板)、'hs300'(沪深300)
   - 避免与股票代码混淆

4. **复权选择**
   - 分析趋势：前复权(fqt=1)
   - 策略回测：后复权(fqt=2)

### 性能优化

1. **批量获取优于单次循环**
   ```python
   # 推荐
   df = qs.get_data(['股票1', '股票2', '股票3'])
   
   # 不推荐
   for code in code_list:
       df = qs.get_data(code)
   ```

2. **缓存历史数据**
   ```python
   # 保存到本地
   df.to_csv('data.csv')
   
   # 从本地读取
   df = pd.read_csv('data.csv', index_col=0)
   ```

---

## 🔗 更多资源

- **完整文档**：查看同目录下《使用说明文档.md》
- **公众号**："Python金融量化"
- **PyPI**：https://pypi.org/project/qstock/

---

## 📝 快速参考表

| 功能 | 函数 | 示例 |
|------|------|------|
| 实时行情 | `realtime_data()` | `qs.realtime_data('沪深A')` |
| 历史K线 | `get_data()` | `qs.get_data('中国平安')` |
| 价格数据 | `get_price()` | `qs.get_price(['平安','茅台'])` |
| 资金流 | `stock_money()` | `qs.stock_money('平安')` |
| 北向资金 | `north_money()` | `qs.north_money()` |
| 财务指标 | `stock_basics()` | `qs.stock_basics('平安')` |
| 财报 | `financial_statement()` | `qs.financial_statement('业绩报表')` |
| 板块列表 | `em_index_name()` | `qs.em_index_name('概念')` |
| 板块成分 | `em_index_member()` | `qs.em_index_member('锂电池')` |
| 宏观数据 | `macro_data()` | `qs.macro_data('gdp')` |
| 新闻 | `news_data()` | `qs.news_data()` |
| K线图 | `plot.kline()` | `plot.kline(df)` |
| 折线图 | `plot.line()` | `plot.line(df.close)` |

---

**开始你的量化之旅吧！** 🚀

